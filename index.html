<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardcore RPG Clicker</title>
    <style>
        :root {
            --bg: #0f0f1a;
            --panel: #1b1b2f;
            --accent: #e43f5a;
            --gold: #ffd700;
            --text: #ffffff;
        }
        body {
            font-family: 'Courier New', Courier, monospace; /* Font ki·ªÉu game retro */
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            user-select: none;
            overflow-x: hidden;
        }

        /* --- Header --- */
        .header {
            background: var(--panel);
            padding: 10px;
            border-bottom: 2px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            font-size: 0.9rem;
        }
        .stat { margin: 5px; font-weight: bold; }
        .coin-box {
            width: 100%;
            text-align: center;
            color: var(--gold);
            font-size: 1.4rem;
            margin-top: 5px;
            text-shadow: 0 0 5px orange;
        }

        /* --- Battle --- */
        .battle-zone {
            height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, #2a2a40 0%, #0f0f1a 80%);
            position: relative;
        }
        
        .enemy-container {
            position: relative;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .enemy-container:active { transform: scale(0.95); }
        
        .enemy-sprite { font-size: 100px; }
        
        .hp-bar-frame {
            width: 200px;
            height: 20px;
            background: #333;
            border: 2px solid #fff;
            margin-top: 10px;
            position: relative;
        }
        .hp-bar-fill {
            height: 100%;
            background: #ff3333;
            width: 100%;
            transition: width 0.2s;
        }
        .boss-badge {
            background: red;
            color: white;
            padding: 2px 5px;
            font-size: 0.7rem;
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
        }

        /* Hi·ªáu ·ª©ng rung m√†n h√¨nh khi b·ªã Boss ƒë√°nh */
        .shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            100% { transform: translate(0, 0); }
        }

        /* Floating Text */
        .float-text {
            position: absolute;
            font-weight: bold;
            pointer-events: none;
            animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-50px); opacity: 0; }
        }

        /* --- Tabs & Shop --- */
        .nav { display: flex; background: #222; }
        .nav-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        .nav-btn.active { color: white; border-bottom: 3px solid var(--accent); background: #333; }
        
        .tab-content { display: none; padding: 15px; max-width: 600px; margin: 0 auto; padding-bottom: 60px;}
        .tab-content.active { display: block; }

        .shop-item {
            background: var(--panel);
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .buy-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
        }
        .buy-btn:disabled { background: #555; cursor: not-allowed; }
        .owned { color: #0f0; font-weight: bold; }

        .withdraw-note { color: #ff5555; font-size: 0.8rem; margin-top: 5px; font-style: italic;}

        /* Notification */
        #notify {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            border: 1px solid var(--accent);
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body>

    <div id="notify">Th√¥ng b√°o</div>

    <div class="header">
        <div class="stat">‚ù§Ô∏è HP: <span id="ui-hp">100</span>/<span id="ui-maxhp">100</span></div>
        <div class="stat">‚öîÔ∏è Dame: <span id="ui-atk">1</span></div>
        <div class="stat">üõ°Ô∏è Gi√°p: <span id="ui-def">0</span></div>
        <div class="coin-box">üí∞ <span id="ui-coin">0</span> Coin</div>
    </div>

    <div class="battle-zone" id="battle-screen">
        <div class="enemy-container" onclick="playerAttack(event)">
            <div class="boss-badge" id="boss-badge">BOSS ZONE</div>
            <div class="enemy-sprite" id="enemy-sprite">üëæ</div>
        </div>
        <h3 id="enemy-name">Qu√°i Level 1</h3>
        <div class="hp-bar-frame">
            <div class="hp-bar-fill" id="enemy-hp-bar"></div>
        </div>
        <p>Enemy HP: <span id="enemy-hp">10</span></p>
    </div>

    <div class="nav">
        <button class="nav-btn active" onclick="switchTab('shop-sword')">‚öîÔ∏è Ki·∫øm</button>
        <button class="nav-btn" onclick="switchTab('shop-pet')">üê∂ Pet</button>
        <button class="nav-btn" onclick="switchTab('boss')">üíÄ Boss</button>
        <button class="nav-btn" onclick="switchTab('withdraw')">üè¶ R√∫t Ti·ªÅn</button>
    </div>

    <div id="shop-sword" class="tab-content active">
        <h3>C·ª≠a H√†ng V≈© Kh√≠</h3>
        <div id="sword-list"></div>
    </div>

    <div id="shop-pet" class="tab-content">
        <h3>C·ª≠a H√†ng Th√∫ C∆∞ng (Auto Dame)</h3>
        <div id="pet-list"></div>
        <p style="color:#aaa; font-size:0.8rem">*Pet s·∫Ω t·ª± ƒë·ªông ƒë√°nh m·ªói gi√¢y.</p>
    </div>

    <div id="boss" class="tab-content">
        <h3>Tri·ªáu h·ªìi Boss</h3>
        <p style="color:red">C·∫£nh b√°o: Boss s·∫Ω t·ª± ƒë·ªông t·∫•n c√¥ng b·∫°n. N·∫øu h·∫øt m√°u, b·∫°n thua cu·ªôc!</p>
        
        <div class="shop-item">
            <div>
                <b>üíÄ Boss Kh√¥ L√¢u (D·ªÖ)</b><br>
                <small>Th∆∞·ªüng: 5.000 Coin</small>
            </div>
            <button class="buy-btn" onclick="summonBoss(1)">Khi√™u chi·∫øn</button>
        </div>

        <div class="shop-item">
            <div>
                <b>üëπ Boss Qu·ª∑ V∆∞∆°ng (Kh√≥)</b><br>
                <small>Th∆∞·ªüng: 50.000 Coin</small>
            </div>
            <button class="buy-btn" onclick="summonBoss(2)">Khi√™u chi·∫øn</button>
        </div>
        
        <button class="buy-btn" style="width:100%; background:#444; margin-top:20px" onclick="fleeBoss()">üè≥Ô∏è ƒê·∫ßu h√†ng / V·ªÅ Farm</button>
    </div>

    <div id="withdraw" class="tab-content">
        <h3>R√∫t Coin v·ªÅ V√≠</h3>
        <p>T·ª∑ gi√°: <b>1 Coin = 1 VNƒê</b></p>
        <p>S·ªë d∆∞ hi·ªán t·∫°i: <span id="w-coin" style="color:var(--gold)">0</span> VNƒê</p>
        
        <label>Nh·∫≠p s·ªë Coin mu·ªën r√∫t (Min 20.000):</label>
        <input type="number" id="w-amount" style="width:100%; padding:10px; margin:10px 0; background:#333; color:white; border:1px solid #555" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng...">
        
        <label>S·ªë t√†i kho·∫£n / v√≠ Momo:</label>
        <input type="text" style="width:100%; padding:10px; margin:10px 0; background:#333; color:white; border:1px solid #555" placeholder="09xxxxxxx">
        
        <button class="buy-btn" style="width:100%; font-size:1.2rem" onclick="processWithdraw()">X√ÅC NH·∫¨N R√öT</button>
        <p class="withdraw-note">*H·ªá th·ªëng s·∫Ω x·ª≠ l√Ω trong 24h (M√¥ ph·ªèng).</p>
    </div>

    <script>
        // --- C·∫•u h√¨nh Game ---
        const SWORDS = [
            { id: 0, name: "Tay Kh√¥ng", dmg: 1, price: 0 },
            { id: 1, name: "Dao GƒÉm C√πn", dmg: 5, price: 500 },
            { id: 2, name: "Ki·∫øm S·∫Øt", dmg: 20, price: 5000 },
            { id: 3, name: "Th√°nh Ki·∫øm", dmg: 100, price: 50000 },
            { id: 4, name: "L∆∞·ª°i H√°i T·ª≠ Th·∫ßn", dmg: 500, price: 200000 }
        ];

        const PETS = [
            { id: 0, name: "Kh√¥ng c√≥", dps: 0, price: 0 },
            { id: 1, name: "G√† Con", dps: 2, price: 2000 },
            { id: 2, name: "S√≥i Hoang", dps: 15, price: 15000 },
            { id: 3, name: "R·ªìng L·ª≠a", dps: 80, price: 100000 }
        ];

        let game = {
            coin: 0,
            hp: 100,
            maxHp: 100,
            def: 0,
            swordId: 0, // ƒêang d√πng ki·∫øm n√†o
            petId: 0,   // ƒêang d√πng pet n√†o
            stage: 1
        };

        let enemy = {
            currentHp: 20,
            maxHp: 20,
            isBoss: false,
            dmg: 0, // Dame c·ªßa boss
            reward: 1
        };

        let bossInterval = null;
        let petInterval = null;

        // --- Load Game ---
        if(localStorage.getItem('hardcore_rpg')) {
            game = JSON.parse(localStorage.getItem('hardcore_rpg'));
        }

        // --- H·ªá th·ªëng ---
        function init() {
            renderShop();
            spawnNormal();
            updateUI();
            
            // Pet ƒë√°nh t·ª± ƒë·ªông
            petInterval = setInterval(() => {
                if(game.petId > 0 && enemy.currentHp > 0) {
                    let petDmg = PETS[game.petId].dps;
                    damageEnemy(petDmg, false);
                }
            }, 1000);
        }

        function updateUI() {
            // Player stats
            const currentSword = SWORDS[game.swordId];
            const currentPet = PETS[game.petId];
            
            document.getElementById('ui-hp').innerText = game.hp;
            document.getElementById('ui-maxhp').innerText = game.maxHp;
            document.getElementById('ui-atk').innerText = currentSword.dmg;
            document.getElementById('ui-coin').innerText = game.coin.toLocaleString();
            document.getElementById('w-coin').innerText = game.coin.toLocaleString();

            // Enemy stats
            document.getElementById('enemy-hp').innerText = Math.max(0, enemy.currentHp);
            let percent = (enemy.currentHp / enemy.maxHp) * 100;
            document.getElementById('enemy-hp-bar').style.width = percent + "%";

            localStorage.setItem('hardcore_rpg', JSON.stringify(game));
        }

        function renderShop() {
            // Render Swords
            let sHtml = "";
            SWORDS.forEach(s => {
                if(s.id === 0) return;
                let owned = game.swordId >= s.id;
                let btnText = owned ? "ƒê√£ S·ªü H·ªØu" : `Mua (${s.price.toLocaleString()})`;
                let disabled = owned ? "disabled" : "";
                
                sHtml += `
                <div class="shop-item">
                    <div>
                        <div style="font-weight:bold; color:orange">${s.name}</div>
                        <div style="font-size:0.8rem">Dame: ${s.dmg}</div>
                    </div>
                    <button class="buy-btn" ${disabled} onclick="buySword(${s.id})">${btnText}</button>
                </div>`;
            });
            document.getElementById('sword-list').innerHTML = sHtml;

            // Render Pets
            let pHtml = "";
            PETS.forEach(p => {
                if(p.id === 0) return;
                let owned = game.petId >= p.id;
                let btnText = owned ? "ƒê√£ c√≥" : `Mua (${p.price.toLocaleString()})`;
                let disabled = owned ? "disabled" : "";
                
                pHtml += `
                <div class="shop-item">
                    <div>
                        <div style="font-weight:bold; color:cyan">${p.name}</div>
                        <div style="font-size:0.8rem">T·ª± ƒë√°nh: ${p.dps} dmg/s</div>
                    </div>
                    <button class="buy-btn" ${disabled} onclick="buyPet(${p.id})">${btnText}</button>
                </div>`;
            });
            document.getElementById('pet-list').innerHTML = pHtml;
        }

        // --- Logic Mua S·∫Øm ---
        function buySword(id) {
            let item = SWORDS[id];
            if(game.coin >= item.price) {
                game.coin -= item.price;
                game.swordId = id; // Trang b·ªã lu√¥n
                showNotify(`ƒê√£ mua v√† trang b·ªã ${item.name}!`);
                renderShop();
                updateUI();
            } else {
                showNotify("Kh√¥ng ƒë·ªß ti·ªÅn!");
            }
        }

        function buyPet(id) {
            let item = PETS[id];
            if(game.coin >= item.price) {
                game.coin -= item.price;
                game.petId = id;
                showNotify(`ƒê√£ g·ªçi ${item.name} ra tr·ª£ chi·∫øn!`);
                renderShop();
                updateUI();
            } else {
                showNotify("Kh√¥ng ƒë·ªß ti·ªÅn!");
            }
        }

        // --- Logic Chi·∫øn ƒê·∫•u ---
        function spawnNormal() {
            clearInterval(bossInterval); // D·ª´ng boss ƒë√°nh
            document.getElementById('boss-badge').style.display = 'none';
            enemy.isBoss = false;
            
            // Qu√°i th∆∞·ªùng m√°u tƒÉng theo stage, nh∆∞ng √≠t ti·ªÅn (Hardcore)
            enemy.maxHp = Math.floor(20 * Math.pow(1.2, game.stage)); 
            enemy.currentHp = enemy.maxHp;
            enemy.reward = Math.floor(2 * Math.pow(1.1, game.stage)); // Ti·ªÅn r·∫•t √≠t
            enemy.dmg = 0;
            
            document.getElementById('enemy-name').innerText = "Qu√°i C·∫•p " + game.stage;
            document.getElementById('enemy-sprite').innerText = "üëæ";
            updateUI();
        }

        function summonBoss(level) {
            clearInterval(bossInterval);
            document.getElementById('boss-badge').style.display = 'block';
            enemy.isBoss = true;
            switchTab('battle-screen'); // Quay v·ªÅ m√†n h√¨nh ƒë√°nh
            
            if(level === 1) {
                enemy.maxHp = 5000;
                enemy.reward = 5000;
                enemy.dmg = 10; // ƒê√°nh 10 m√°u m·ªói gi√¢y
                document.getElementById('enemy-name').innerText = "BOSS KH√î L√ÇU";
                document.getElementById('enemy-sprite').innerText = "üíÄ";
            } else {
                enemy.maxHp = 50000;
                enemy.reward = 50000;
                enemy.dmg = 50; // ƒê√°nh 50 m√°u m·ªói gi√¢y
                document.getElementById('enemy-name').innerText = "QU·ª∂ V∆Ø∆†NG";
                document.getElementById('enemy-sprite').innerText = "üëπ";
            }
            enemy.currentHp = enemy.maxHp;
            showNotify("BOSS ƒê√É XU·∫§T HI·ªÜN! C·∫®N TH·∫¨N!");
            updateUI();

            // BOSS T·ª∞ ƒê√ÅNH (Mechanic m·ªõi)
            bossInterval = setInterval(() => {
                if(game.hp > 0) {
                    game.hp -= enemy.dmg;
                    
                    // Rung m√†n h√¨nh
                    document.body.classList.add('shake');
                    setTimeout(() => document.body.classList.remove('shake'), 500);
                    
                    // Hi·ªán dame boss g√¢y ra
                    showFloatText(`-${enemy.dmg}`, window.innerWidth/2, window.innerHeight/2, 'red');

                    if(game.hp <= 0) {
                        game.hp = 0;
                        gameOver();
                    }
                    updateUI();
                }
            }, 1000);
        }

        function fleeBoss() {
            spawnNormal();
            // H·ªìi ph·ª•c 1 √≠t m√°u khi ch·∫°y
            game.hp = game.maxHp;
            showNotify("ƒê√£ ch·∫°y tr·ªën th√†nh c√¥ng!");
        }

        function gameOver() {
            clearInterval(bossInterval);
            alert("B·∫†N ƒê√É B·ªä BOSS ƒê√ÅNH B·∫†I!");
            game.hp = game.maxHp; // H·ªìi sinh
            spawnNormal();
        }

        function playerAttack(e) {
            let dmg = SWORDS[game.swordId].dmg;
            damageEnemy(dmg, true, e.clientX, e.clientY);
        }

        function damageEnemy(amount, isPlayer, x, y) {
            enemy.currentHp -= amount;
            
            if(isPlayer) {
                showFloatText(`-${amount}`, x, y, 'white');
            }

            if(enemy.currentHp <= 0) {
                // Th·∫Øng
                game.coin += enemy.reward;
                showNotify(`H·∫° g·ª•c! +${enemy.reward} Coin`);
                
                if(enemy.isBoss) {
                    alert(`CH√öC M·ª™NG! B·∫†N ƒê√É DI·ªÜT BOSS V√Ä NH·∫¨N ${enemy.reward} COIN`);
                    game.hp = game.maxHp; // H·ªìi m√°u sau khi th·∫Øng boss
                    spawnNormal();
                } else {
                    game.stage++;
                    spawnNormal();
                }
            }
            updateUI();
        }

        // --- R√∫t ti·ªÅn ---
        function processWithdraw() {
            let amount = parseInt(document.getElementById('w-amount').value);
            if(!amount || amount < 20000) {
                alert("S·ªë ti·ªÅn r√∫t t·ªëi thi·ªÉu l√† 20.000 Coin!");
                return;
            }
            if(game.coin >= amount) {
                game.coin -= amount;
                updateUI();
                alert(`ƒê√£ g·ª≠i y√™u c·∫ßu r√∫t ${amount.toLocaleString()} VNƒê.\nH·ªá th·ªëng ƒëang x·ª≠ l√Ω...`);
            } else {
                alert("S·ªë d∆∞ kh√¥ng ƒë·ªß!");
            }
        }

        // Utility
        function switchTab(id) {
            if(id === 'battle-screen') {
                 // Do nothing, just scroll or logic
                 document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            } else {
                document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            }
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function showNotify(msg) {
            let n = document.getElementById('notify');
            n.innerText = msg;
            n.style.display = 'block';
            setTimeout(() => n.style.display = 'none', 2000);
        }

        function showFloatText(txt, x, y, color) {
            let el = document.createElement('div');
            el.className = 'float-text';
            el.innerText = txt;
            el.style.left = (x || window.innerWidth/2) + 'px';
            el.style.top = (y || 200) + 'px';
            el.style.color = color;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // Start
        init();

    </script>
</body>
</html>
